<html lang="pt-br">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="/node_modules/moment/moment.js"></script>
      <script src="/node_modules/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
      <link rel="stylesheet" href="/style.css">
      <script>
         moment.locale("pt-br");
         vis.moment = moment;
         vis.moment.locale("pt-br");
      </script>
      <title>Document</title>
   </head>
    
  
  <body>
    <main>
      <h1>Timeline</h1>
      <div id="visualization"></div>
  
      <div class="container text-center d-flex align-items-center">
        <div class="row">
          <div class="col-md-6">
            <div class="wrapper bg-light">
              <form id="event-form">
                <label for="start">Início:</label>
                <input type="date" id="start" name="start" required />
  
                <label for="end">Fim:</label>
                <input type="date" id="end" name="end" />
  
                <label for="group">Grupo:</label>
                <input type="text" id="group" name="group" required />
  
                <label for="content">Conteúdo:</label>
                <input type="text" id="content" name="content" required />
  
                <button type="submit">Adicionar evento</button>
                <button type="button" onclick="alterarEventos()">Download eventos em JSON</button>
                <input type="file" id="inputFile" />
              </form>
            </div>
          </div>
          <div class="col-md-6 colored-box">
            <p>Texto a ser inserido posteriormente </p>
          </div>
        </div>
      </div>
    </main>
  
    

    <script type="text/javascript">
      // Importar moment.js e configurar localização para pt-br
      moment.locale("pt-br");
      vis.moment = moment;
      vis.moment.locale("pt-br");

      const eventForm = document.getElementById("event-form");
      const inputFile = document.getElementById("inputFile");

      // Adicionar evento de submit ao formulário de adicionar evento
      eventForm.addEventListener("submit", function (event) {
  event.preventDefault();

  const start = new Date(document.getElementById("start").value);
  const end = document.getElementById("end").value ? new Date(document.getElementById("end").value) : null;
  const group = document.getElementById("group").value;
  const content = `<div class="alinha"><img src="/img/scp_trans.png"> <div>${document.getElementById("content").value}</div></div>`;

  items.add({
    start,
    end,
    group,
    content,
  });

  eventForm.reset();
});

      // Adicionar evento de change ao input de arquivo
      inputFile.addEventListener("change", function () {
        const file = inputFile.files[0];

        const reader = new FileReader();

        reader.onload = function (event) {
          const eventos = JSON.parse(event.target.result);

          items.clear();
          items.add(eventos);

          timeline.fit();
        };

        reader.readAsText(file);
      });

      // Adicionar evento de click ao botão de download
      function alterarEventos() {
        const eventos = items.get({
          fields: ["id", "start", "end", "group", "content"],
        });

        const eventosJson = JSON.stringify(eventos, null, 2);

        const blob = new Blob([eventosJson], { type: "application/json" });

        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "eventos.json";
        link.click();
      }

      // Inicialização da timeline
      const container = document.getElementById("visualization");

      const groups = new vis.DataSet([
        {
          id: "Infinity",
          content: '<img src="/img/scp_trans.png">',
          subgroupOrder: function (a, b) {
            return a.subgroupOrder - b.subgroupOrder;
          },
          subgroupStack: { sg_1: false, sg_2: false, sg_3: false },
        },
        {
          id: "Jogadores",
          content: "Jogadores",
        },
      ]);

      const items = new vis.DataSet([]);

      const options = {
        format: {
          minorLabels: {
            minute: "h:mma",
            hour: "ha",
          },
        },
        editable: {
          add: true,
          updateTime: true,
          updateGroup: true,
          remove: true,
        },
        multiselect: true,
        margin: {
          item: 20,
          axis: 40,
        },
      };

      const timeline = new vis.Timeline(container, items, groups, options);

      // Log de mudanças na timeline
      items.on("*", function (event, properties) {
        console.log(event, properties.items);
      });
    </script>
  </body>
</html>
